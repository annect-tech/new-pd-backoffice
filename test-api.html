<!DOCTYPE html>
<html>
<head>
    <title>Teste API Allowed Cities</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .test { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        pre { background: #f5f5f5; padding: 10px; overflow: auto; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Teste API Allowed Cities</h1>
    
    <div class="test">
        <h2>1. Teste GET simples (sem query params)</h2>
        <button onclick="testGet1()">Testar</button>
        <pre id="result1"></pre>
    </div>
    
    <div class="test">
        <h2>2. Teste GET com page e size</h2>
        <button onclick="testGet2()">Testar</button>
        <pre id="result2"></pre>
    </div>
    
    <div class="test">
        <h2>3. Teste GET apenas com page</h2>
        <button onclick="testGet3()">Testar</button>
        <pre id="result3"></pre>
    </div>

    <div class="test">
        <h2>4. Verificar estrutura da requisição</h2>
        <button onclick="testHeaders()">Testar</button>
        <pre id="result4"></pre>
    </div>

    <script>
        const API_URL = "http://186.248.135.172:31535";
        const token = localStorage.getItem("persist:root") 
            ? JSON.parse(JSON.parse(localStorage.getItem("persist:root")).auth).accessToken
            : null;

        async function makeRequest(url, method = "GET") {
            try {
                const response = await fetch(url, {
                    method,
                    headers: {
                        "Authorization": `Bearer ${token}`,
                        "Content-Type": "application/json",
                    },
                });
                
                const data = await response.json();
                
                return {
                    status: response.status,
                    statusText: response.statusText,
                    headers: Object.fromEntries(response.headers.entries()),
                    data,
                    url,
                };
            } catch (error) {
                return {
                    error: error.message,
                    url,
                };
            }
        }

        async function testGet1() {
            const result = await makeRequest(`${API_URL}/admin/allowed-cities`);
            document.getElementById("result1").textContent = JSON.stringify(result, null, 2);
        }

        async function testGet2() {
            const result = await makeRequest(`${API_URL}/admin/allowed-cities?page=1&size=10`);
            document.getElementById("result2").textContent = JSON.stringify(result, null, 2);
        }

        async function testGet3() {
            const result = await makeRequest(`${API_URL}/admin/allowed-cities?page=1`);
            document.getElementById("result3").textContent = JSON.stringify(result, null, 2);
        }

        async function testHeaders() {
            const info = {
                hasToken: !!token,
                tokenStart: token ? token.substring(0, 30) + "..." : null,
                localStorage: localStorage.getItem("persist:root") ? "existe" : "não existe",
            };
            document.getElementById("result4").textContent = JSON.stringify(info, null, 2);
        }

        // Auto-teste ao carregar
        if (token) {
            console.log("Token encontrado, pronto para testar");
        } else {
            console.error("Token não encontrado! Faça login primeiro em http://localhost:5100");
        }
    </script>
</body>
</html>
